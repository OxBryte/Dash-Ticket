// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Models

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  password  String?  // Hashed
  role      String   @default("ATTENDEE") // ADMIN, ORGANIZER, ATTENDEE, STAFF
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organizedEvents Event[] @relation("OrganizedEvents")
  orders          Order[]
}

model Venue {
  id          String   @id @default(uuid())
  name        String
  address     String
  city        String
  state       String
  zip         String
  country     String
  capacity    Int
  latitude    Float?
  longitude   Float?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  events Event[]
}

model Event {
  id          String   @id @default(uuid())
  title       String
  description String
  shortDescription String?
  category    String   @default("OTHER") // CONCERT, SPORTS, CONFERENCE, FESTIVAL, etc.
  status      String   @default("DRAFT") // DRAFT, PENDING_APPROVAL, SCHEDULED, ON_SALE, etc.
  
  // Images
  imageUrl    String?
  gallery     String? // JSON string for array of URLs
  
  // Date & Time
  startDate   DateTime
  endDate     DateTime?
  doorsOpen   DateTime?
  
  // Relations
  organizerId String
  organizer   User   @relation("OrganizedEvents", fields: [organizerId], references: [id])
  
  venueId     String?
  venue       Venue?  @relation(fields: [venueId], references: [id])
  
  ticketTypes TicketType[]
  orders      Order[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model TicketType {
  id          String   @id @default(uuid())
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id])
  
  name        String
  description String?
  price       Int      // In cents
  currency    String   @default("USD")
  
  quantityTotal Int
  quantitySold  Int    @default(0)
  
  saleStart   DateTime?
  saleEnd     DateTime?
  
  minPerOrder Int @default(1)
  maxPerOrder Int @default(10)
  
  orderItems  OrderItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Order {
  id            String   @id @default(uuid())
  userId        String?  // Optional for guest checkout
  user          User?    @relation(fields: [userId], references: [id])
  
  eventId       String
  event         Event    @relation(fields: [eventId], references: [id])
  
  status        String   @default("PENDING") // PENDING, COMPLETED, FAILED, REFUNDED, CANCELLED
  totalAmount   Int      // In cents
  currency      String   @default("USD")
  
  // Customer Info (snapshot for history)
  customerEmail String
  customerName  String
  
  items         OrderItem[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model OrderItem {
  id           String     @id @default(uuid())
  orderId      String
  order        Order      @relation(fields: [orderId], references: [id])
  
  ticketTypeId String
  ticketType   TicketType @relation(fields: [ticketTypeId], references: [id])
  
  quantity     Int
  pricePerItem Int        // In cents, snapshot at purchase
  
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}
